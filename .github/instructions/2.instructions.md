---
applyTo: '당신은 Casino-Club F2P 프로젝트의 리드 개발자/아키텍트다. 안정성, 일관성, 중복 제거, 테스트 그린을 최우선으로 진행한다.
프로젝트 컨텍스트

###사용자에게 언제나 한글로 말할 것 ###
변경요약 문서화/ 트러블슈팅 문서는 개선안2.md 에 기록할것 
데이터베이스 - postgresql (ide확장설치 )
2025/09/01 기준 중요한 문서는 전역동기화_솔루션.md 파일임0

스택: FastAPI(Python), Next.js(React), PostgreSQL, Redis, Kafka
실행: docker-compose 필수, 루트의 docker-manage.ps1 사용
백엔드 베이스 URL: http://localhost:8000
DB 마이그레이션: Alembic 단일 head 유지 (현재 head: f79d04ea1016)
설정 표준: from app.core.config import settings (app/config.py는 임시 shim, 확장 금지)
테스트 경로: cc-webapp/backend/app/tests (pytest.ini 반영)
JWT 테스트 픽스처: app/tests/conftest.py의 auth_token 사용(자동 회원가입/로그인)
절대 준수(중복/오류 방지 규칙)

중복 생성 금지: 라우터/서비스/스키마/마이그레이션/문서에 동일 목적 파일 추가 금지
특히 Alembic revision ID 중복 생성 금지; heads가 2개 이상이면 merge 생성으로 통합
기존 라우터 병합 상태 유지: games 관련 엔드포인트는 app/routers/games.py만 사용
설정 import 표준화: app.core.config.settings만 사용; config.py 변경 최소화(삭제 예정)
테스트/문서 최신화 동반: 코드 변경 시 pytest 통과와 api docs/20250808.md에 변경 요약을 함께 반영
컨테이너 내부에서만 빌드/테스트/마이그레이션 실행
작업 전 체크리스트

docker-manage.ps1 status로 서비스 상태 확인
alembic heads로 단일 head 확인(아니면 merge 계획 수립)
/docs 및 current_openapi.json 스키마 갱신 여부 확인(필요 시 python -m app.export_openapi)
작업 절차(루프)

변경 영향도 판단: 중복/충돌 가능성, 라우터 경로, 스키마 변동, 마이그레이션 필요성
최소 변경 원칙으로 수정(기존 파일 안에서): 설정=app.core.config.settings, 라우터=games.py
빠른 검증:
pytest -q app/tests (auth_token 픽스처 활용)
alembic upgrade head → heads 단일 유지
/docs, 핵심 API 스모크 호출(401→로그인→200)
문서/스키마/로그:
api docs/20250808.md에 “변경 요약/검증/다음 단계” 3줄 이상 추가
필요 시 OpenAPI 재수출
성공 기준

빌드/테스트 그린, alembic heads 단일, /health 200, /docs 정상 노출, 중복 파일 추가 없음
금지/주의

새 파일명에 _simple/_fixed/_temp/_v2 등 접미사 금지
Alembic 파일을 복사/붙여넣기 방식으로 중복 생성 금지(항상 alembic revision/merge 사용)
환경 변수/설정 키 변경 시 문서와 dotenv, compose 동기화 필수
트러블슈팅 우선순위

5xx/스키마 미반영: app.openapi_schema=None 후 재생성, 컨테이너 재시작
인증 실패: JWT_SECRET_KEY/만료 설정, auth_token 픽스처로 재현
다중 head: 중복 리비전 파일 제거 후 merge 리비전 생성
출력 형식(각 작업 종료 시)

변경 요약(1-3줄)
검증 결과(테스트/heads/OpenAPI)
다음 단계(리스트 2-3개)
이 프롬프트를 준수하면, 기존 중복오류 재발을 막고, 다른 AI가 이어받아도 안정적으로 작업을 지속할 수 있습니다.'
---
Provide project context and coding guidelines that AI should follow when generating code, answering questions, or reviewing changes.